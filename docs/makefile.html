<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="mathieu.fourre" />
  <title>GNU Make</title>
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
  <link rel="stylesheet" href="style.css" />
<style type="text/css">
  :root {
/*
  --color: #2096ba;
  --color-secondary: #2096ba;
  --color-accent: #f7f8fa;
  --color-text: #222426;
  --color-shadow: #c5d2db;
  --width-content: 720px;
  }
*/
  
  code, samp {
    font-size: 1.2em;
  }

  nav {
    justify-content: space-evenly;
  }

  
  a:hover {
    filter: none;
    color: #df6e21;
  }
</style>
</head>
<body>
<header id="title-block-header">
  <nav id="TOC">
      <a href="/"><img alt="Logo" src="https://www.epita.fr/wp-content/themes/epita-theme/assets/img/svg/EPITA_LOGO_INGENIEUR_CMJN.svg" height="70"></a>
            <ul>
          <li><a href="#">Navigation</a>
            <ul>
            <li><a href="#lets-use-make">Let’s use Make</a></li>
            <li><a href="#why-use-make">Why use Make</a></li>
            <li><a href="#goals">Goals</a></li>
            <li><a href="#why-make-is-not-that-easy-to-learn">Why Make is not that easy to learn</a></li>
            <li><a href="#implicit-variables">Implicit variables</a></li>
            <li><a href="#changing-variables-value-only-in-specifc-rules">Changing variables value only in specifc rules</a></li>
            <li><a href="#pattern-rules">Pattern rules</a></li>
            <li><a href="#automatic-variables">Automatic variables</a></li>
            <li><a href="#exercice">Exercice</a></li>
            </ul>
          </li>
      </ul>
        </nav>
<h1 class="title">GNU Make</h1>
<p class="author">mathieu.fourre</p>
</header>
<main>
<hr>
<article>
<h1 id="lets-use-make">Let’s use Make</h1>
<p>You have already use <code>make</code> this year but many of you haven’t really understood it’s power.</p>
<h1 id="why-use-make">Why use Make</h1>
<ul>
<li>flexible</li>
<li>easy to use for c projects</li>
<li>way better than and alias for gcc</li>
</ul>
<h1 id="goals">Goals</h1>
<p>The goal is to make you confortable enough with make so that you can use it during the piscine. As mentioned in the Editors page, the piscine is about efficiency. Using (<strong>and reusing</strong>) a makefile is a good first step.</p>
<h1 id="why-make-is-not-that-easy-to-learn">Why Make is not that easy to learn</h1>
<p>The strength and weakness of <code>make</code> is that there are many implicite rules.</p>
<p>For example:</p>
<pre class="makefile"><code>OBJ = main.o func.o

main: main.o
    gcc main.o -o main

main.o: main.c
    gcc -c main.c -o main.o

func.o: func.c
    gcc -c func.c -o func.o</code></pre>
<p>can be written:</p>
<pre class="makefile"><code>OBJ = main.o func.o

main: $(OBJ)</code></pre>
<p>Here are some of the default rules (use <code>make -p</code> to have them all):</p>
<pre class="makefile"><code># default
COMPILE.c = $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c

OUTPUT_OPTION = -o $@

%.o: %.c
#  recipe to execute (built-in):
    $(COMPILE.c) $(OUTPUT_OPTION) $&lt;

%: %.o
#  recipe to execute (built-in):
    $(LINK.o) $^ $(LOADLIBES) $(LDLIBS) -o $@</code></pre>
<p>doc: <a href="https://www.gnu.org/software/make/manual/html_node/Implicit-Rules.html">Implicit-Rules</a></p>
<h1 id="implicit-variables">Implicit variables</h1>
<p>As you can see, these implicit rules use standardised variables. You may change these variables.</p>
<p>For example, during <code>42sh</code>, you will use something like this.</p>
<pre class="makefile"><code>CC=gcc # explicitly set the c compiler
CFLAGS=-Wall -Werror -Wextra -pedantic -std=c99</code></pre>
<p>These variables are very useful and flexible.</p>
<p>Here are some of these variables:</p>
<pre class="make"><code>CC= # c compiler
CFLAGS= # c flags
CPPFLAGS= # c pre-processor flags (ex: -D_GNU_SOURCE)
LDFLAGS= # linker flags
LDLIBS= # libraries (ex: -lm)</code></pre>
<p>doc: <a href="https://www.gnu.org/software/make/manual/html_node/Implicit-Variables.html">Implicit-Variables</a></p>
<h1 id="changing-variables-value-only-in-specifc-rules">Changing variables value only in specifc rules</h1>
<p>Sometimes, you may want to change the value of a variable only for a rule.</p>
<p>To do this, you need to add a line just above the rule like so:</p>
<pre class="makefile"><code>rule_with_debug: CFLAGS += -g
rule_with_debug: file.o</code></pre>
<p>doc: <a href="https://ftp.gnu.org/old-gnu/Manuals/make-3.79.1/html_chapter/make_6.html#SEC65">appending more text to variables</a></p>
<h1 id="pattern-rules">Pattern rules</h1>
<p>You can use <code>%</code> as a sort of wildcard. For example, to define a rule that create a <code>.foo</code> from a <code>.bar</code> file with the same name, you can do:</p>
<pre class="makefile"><code>%.foo: %.bar
    # do things</code></pre>
<p>you can also set prefixes:</p>
<pre class="makefile"><code>folder1/%.foo: folder2/%.bar
    # do things</code></pre>
<p>doc: <a href="https://www.gnu.org/software/make/manual/make.html#Pattern-Rules">Pattern-Rules</a></p>
<h1 id="automatic-variables">Automatic variables</h1>
<p>I you are following you may be wondering how you can write a rule while using <code>%</code>. Indeed, this doesn’t work:</p>
<pre class="makefile"><code>%.o: %.c
    gcc -c %.c -o %.o</code></pre>
<p>To do this, you will have to use automatic variables.</p>
<ul>
<li><code>$@</code> The file name of the target of the rule</li>
<li><code>$&lt;</code> The name of the first prerequisite</li>
<li><code>$?</code> The names of all the prerequisites that are newer than the target</li>
<li><code>$^</code> The names of all the prerequisites</li>
<li><code>$*</code> The stem of an implicit rule</li>
</ul>
<p>For example:</p>
<pre class="makefile"><code>all: file.o

%.o: %.c header.h
    echo $@ # file.o
    echo $&lt; # file.c
    echo $^ # file.c header.h
    echo $* # file</code></pre>
<p>doc: <a href="https://www.gnu.org/software/make/manual/make.html#Automatic-Variables">Automatic-variables</a></p>
<h1 id="exercice">Exercice</h1>
<p>Your goal is to prepare a makefile to help building piscine-type exercises.</p>
<pre class="sh"><code>$ ls
Makefile
file1.c
file2.c
file3.c
file4.c</code></pre>
<p>You will create 3 targets:</p>
<ul>
<li>library: produce a libfile.a library</li>
<li>test:</li>
<li>clean</li>
</ul>
<p>Here is the gnu manual : <a href="https://www.gnu.org/software/make/manual/make.html">link</a></p>
<hr>
</article>
</main>
</body>
</html>
